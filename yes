import { LightningElement, track, wire } from 'lwc';
import { ShowToastEvent } from 'lightning/platformShowToastEvent';
import createCourse from '@salesforce/apex/CourseController.createCourse';
import getInstructors from '@salesforce/apex/CourseController.getInstructors';

export default class CreateCourse extends LightningElement {
    @track courseName = '';
    @track duration = '';
    @track numberOfSeats = '';
    @track courseDate = ''; // updated variable name
    @track selectedInstructor = '';
    @track instructorOptions = [];

    @wire(getInstructors)
    wiredInstructors({ error, data }) {
        if (data) {
            this.instructorOptions = data.map(instructor => {
                return { label: instructor.Name, value: instructor.Id };
            });
        } else if (error) {
            this.dispatchEvent(
                new ShowToastEvent({
                    title: 'Error loading instructors',
                    message: error.body.message,
                    variant: 'error',
                }),
            );
        }
    }

    handleInputChange(event) {
        const field = event.target.dataset.id;
        if (field === 'Name') {
            this.courseName = event.target.value;
        } else if (field === 'Duration__c') {
            this.duration = event.target.value;
        } else if (field === 'Number_Of_Seats__c') {
            this.numberOfSeats = event.target.value;
        } else if (field === 'Date__c') {
            this.courseDate = event.target.value; // updated variable name
        } else if (field === 'Instructor__c') {
            this.selectedInstructor = event.target.value;
        }
    }

    handleCreateCourse() {
        createCourse({ 
            name: this.courseName, 
            duration: this.duration, 
            numberOfSeats: this.numberOfSeats, 
            courseDate: this.courseDate, // updated variable name
            instructorId: this.selectedInstructor 
        })
            .then(courseId => {
                this.dispatchEvent(
                    new ShowToastEvent({
                        title: 'Success',
                        message: 'Course created with Id: ' + courseId,
                        variant: 'success',
                    }),
                );
                // Reset form
                this.courseName = '';
                this.duration = '';
                this.numberOfSeats = '';
                this.courseDate = ''; // updated variable name
                this.selectedInstructor = '';
            })
            .catch(error => {
                this.dispatchEvent(
                    new ShowToastEvent({
                        title: 'Error creating record',
                        message: error.body.message,
                        variant: 'error',
                    }),
                );
            });
    }
}